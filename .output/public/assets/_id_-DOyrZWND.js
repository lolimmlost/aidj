import{c as T,t as K,k as L,j as s,B as I}from"./main-Jnb6I3g-.js";import{b as P,d as q,a as A,c as B,C as $}from"./card-BWKW-5Az.js";import{u as G}from"./useQuery-BfVrW5pL.js";import{a as H}from"./auth-client-BCO5yylJ.js";function ee(){const e=T.c(45);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={from:"/dashboard/recommendations/[id]"},e[0]=n):n=e[0];const{id:o}=K(n),{data:y}=H.useSession(),v=L(z),a=atob(o),O=y?.user.id;let w;e[1]!==o||e[2]!==O?(w=["recommendation-detail",o,O],e[1]=o,e[2]=O,e[3]=w):w=e[3];const{data:j,isLoading:R,error:S}=G({queryKey:w,queryFn:async()=>{const t=await fetch("/api/recommendations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:`Provide a detailed explanation why "${a}" is recommended based on user listening history and preferences. Return as JSON: {"explanation": "detailed reason"}`})});if(!t.ok)throw new Error("Failed to fetch recommendation detail");const Q=await t.json();return Q.timestamp=new Date().toISOString(),Q},enabled:!!y});if(R){let t;return e[4]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsx("p",{className:"container mx-auto p-6",children:"Loading detail..."}),e[4]=t):t=e[4],t}if(S){let t;return e[5]!==S.message?(t=s.jsxs("p",{className:"container mx-auto p-6 text-destructive",children:["Error: ",S.message]}),e[5]=S.message,e[6]=t):t=e[6],t}const F=(j.data.recommendations?.find(t=>t.song===a)||{explanation:j.data.explanation||"No explanation available."}).explanation;btoa(a);const J=M(a);let C;e[7]!==a?(C=t=>{U(a,t)},e[7]=a,e[8]=C):C=e[8];const i=C;let N;e[9]!==v?(N=t=>{v(t,[{id:t,name:t,albumId:"",duration:0,track:1,url:"",artist:""}])},e[9]=v,e[10]=N):N=e[10];const _=N;let r;e[11]!==a?(r=s.jsx(P,{children:a}),e[11]=a,e[12]=r):r=e[12];let l;e[13]!==j.timestamp?(l=new Date(j.timestamp).toLocaleString(),e[13]=j.timestamp,e[14]=l):l=e[14];let d;e[15]!==l?(d=s.jsxs(q,{children:["Generated at ",l," (timeout: 5s)"]}),e[15]=l,e[16]=d):d=e[16];let c;e[17]!==r||e[18]!==d?(c=s.jsxs(A,{children:[r,d]}),e[17]=r,e[18]=d,e[19]=c):c=e[19];let m;e[20]!==F?(m=s.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:F}),e[20]=F,e[21]=m):m=e[21];const D=J.up?"default":"ghost";let u;e[22]!==i?(u=()=>i("up"),e[22]=i,e[23]=u):u=e[23];let f;e[24]!==D||e[25]!==u?(f=s.jsx(I,{variant:D,onClick:u,children:"👍"}),e[24]=D,e[25]=u,e[26]=f):f=e[26];const E=J.down?"default":"ghost";let p;e[27]!==i?(p=()=>i("down"),e[27]=i,e[28]=p):p=e[28];let h;e[29]!==E||e[30]!==p?(h=s.jsx(I,{variant:E,onClick:p,children:"👎"}),e[29]=E,e[30]=p,e[31]=h):h=e[31];let x;e[32]!==f||e[33]!==h?(x=s.jsxs("div",{className:"space-x-2",children:[f,h]}),e[32]=f,e[33]=h,e[34]=x):x=e[34];let g;e[35]!==_||e[36]!==a?(g=s.jsx(I,{variant:"ghost",onClick:()=>_(a),children:"Add to Queue"}),e[35]=_,e[36]=a,e[37]=g):g=e[37];let b;e[38]!==x||e[39]!==g||e[40]!==m?(b=s.jsxs(B,{className:"space-y-4",children:[m,x,g]}),e[38]=x,e[39]=g,e[40]=m,e[41]=b):b=e[41];let k;return e[42]!==b||e[43]!==c?(k=s.jsx("div",{className:"container mx-auto p-6",children:s.jsxs($,{className:"bg-card text-card-foreground border-card",children:[c,b]})}),e[42]=b,e[43]=c,e[44]=k):k=e[44],k}function z(e){return e.playSong}function M(e){const n=btoa(e),o=localStorage.getItem(n);if(!o)return{up:!1,down:!1};try{return JSON.parse(atob(o))}catch{return{up:!1,down:!1}}}function U(e,n){const o=btoa(e),y={up:n==="up",down:n==="down"};localStorage.setItem(o,btoa(JSON.stringify(y)))}export{ee as component};
