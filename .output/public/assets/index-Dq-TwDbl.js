import{c as Oe,r as be,g as qe,k as je,j as t,L as u,B as d}from"./main-Jnb6I3g-.js";import{u as Se}from"./useQuery-BfVrW5pL.js";import{a as De}from"./auth-client-BCO5yylJ.js";import{C as Ne,a as ve,b as Ce,d as ke,c as we}from"./card-BWKW-5Az.js";import{S as Ke,a as Fe,b as Je,c as _e,d as ze}from"./select-s3rMheNq.js";import{I as Be}from"./input-DlDkLuiH.js";import{s as He}from"./navidrome-BTrOeuFz.js";import"./Combination-CFcqJjDu.js";import"./index-BfcKVs0x.js";function Re(e,a){return e.split("").map((o,n)=>String.fromCharCode(o.charCodeAt(0)^a.charCodeAt(n%a.length))).join("")}function $e(e,a){return e.split("").map((o,n)=>String.fromCharCode(o.charCodeAt(0)^a.charCodeAt(n%a.length))).join("")}const Ee="mySecretKey12345";function Ie(e){const a=btoa(e),o=localStorage.getItem(a);if(!o)return{up:!1,down:!1};try{const n=$e(atob(o),Ee);return JSON.parse(n)}catch{return{up:!1,down:!1}}}function Ve(e,a){const o=btoa(e),c=JSON.stringify({up:a==="up",down:a==="down"}),P=Re(c,Ee);localStorage.setItem(o,btoa(P))}function ct(){const e=Oe.c(85),[a,o]=be.useState("similar"),{data:n}=De.useSession(),c=qe(),P=je(Ze),le=je(Xe),[h,ye]=be.useState("");let Q,i;e[0]!==h?(i=h.trim(),Q=btoa(i),e[0]=h,e[1]=Q,e[2]=i):(Q=e[1],i=e[2]);const m=Q,oe=n?.user.id;let f;e[3]!==oe||e[4]!==a?(f=["recommendations",oe,a],e[3]=oe,e[4]=a,e[5]=f):f=e[5];let x;e[6]!==a?(x=async()=>{const r=await fetch("/api/recommendations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:a==="similar"?"similar artists to your favorites":"mood-based recommendations for relaxation"})});if(!r.ok)throw new Error("Failed to fetch recommendations");const l=await r.json();return l.timestamp=new Date().toISOString(),l},e[6]=a,e[7]=x):x=e[7];const ne=!!n;let T;e[8]!==f||e[9]!==x||e[10]!==ne?(T={queryKey:f,queryFn:x,enabled:ne},e[8]=f,e[9]=x,e[10]=ne,e[11]=T):T=e[11];const{data:ie,isLoading:ce,error:O}=Se(T);let q;e[12]!==c||e[13]!==n?.user?(q=(s,r)=>{Ve(s,r),c.invalidateQueries({queryKey:["recommendations",n?.user.id,r]})},e[12]=c,e[13]=n?.user,e[14]=q):q=e[14];const D=q,Ae=async s=>{try{console.log("Queuing recommendation:",s);const r=await He(s,0,1);if(console.log("Search results for queue:",r),r.length>0){const l=r[0];P(l.id,[l]),console.log("Queued song:",l)}else he(s)}catch(r){console.error("Search failed for queue:",r),he(s)}};let p,g;e[15]!==m||e[16]!==i?(p=["playlist",m,i],g=async()=>{const s=localStorage.getItem(`playlist-${m}`);if(s)return JSON.parse(s);const r=await fetch("/api/playlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({style:i})});if(!r.ok)throw new Error("Failed to fetch playlist");const l=await r.json();return localStorage.setItem(`playlist-${m}`,JSON.stringify(l)),l},e[15]=m,e[16]=i,e[17]=p,e[18]=g):(p=e[17],g=e[18]);const de=!!i&&!!n;let K;e[19]!==de||e[20]!==p||e[21]!==g?(K={queryKey:p,queryFn:g,enabled:de},e[19]=de,e[20]=p,e[21]=g,e[22]=K):K=e[22];const{data:y,isLoading:me,error:F,refetch:ue}=Se(K);let J;e[23]!==le||e[24]!==y?(J=()=>{if(!y)return;const s=y.data.playlist.filter(Ue).map(Ye);s.length>0?le(s):alert("No songs available in library for this playlist.")},e[23]=le,e[24]=y,e[25]=J):J=e[25];const Le=J,he=Me;let z;e[26]!==c?(z=()=>{Object.keys(localStorage).filter(Ge).forEach(We),c.invalidateQueries({queryKey:["playlist"]}),ye("")},e[26]=c,e[27]=z):z=e[27];const fe=z,Pe="container mx-auto p-6 space-y-6";let b;e[28]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-4xl font-bold tracking-tight mb-2",children:"Music Dashboard"}),t.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"Welcome to your music library. Explore artists, search for songs, and enjoy seamless playback."})]}),e[28]=b):b=e[28];let B;e[29]===Symbol.for("react.memo_cache_sentinel")?(B=t.jsx("h2",{className:"text-2xl font-semibold",children:"AI Recommendations"}),e[29]=B):B=e[29];let H;e[30]===Symbol.for("react.memo_cache_sentinel")?(H=s=>o(s),e[30]=H):H=e[30];let R;e[31]===Symbol.for("react.memo_cache_sentinel")?(R=t.jsx(Ke,{className:"w-[180px]",children:t.jsx(Fe,{placeholder:"Type"})}),e[31]=R):R=e[31];let $;e[32]===Symbol.for("react.memo_cache_sentinel")?($=t.jsxs(Je,{children:[t.jsx(_e,{value:"similar",children:"Similar Artists"}),t.jsx(_e,{value:"mood",children:"Mood-Based"})]}),e[32]=$):$=e[32];let j;e[33]!==a?(j=t.jsxs("div",{className:"flex justify-between items-center",children:[B,t.jsxs(ze,{value:a,onValueChange:H,children:[R,$]})]}),e[33]=a,e[34]=j):j=e[34];let S;e[35]!==ce?(S=ce&&t.jsx("p",{children:"Loading recommendations..."}),e[35]=ce,e[36]=S):S=e[36];let N;e[37]!==O?(N=O&&t.jsxs("p",{className:"text-destructive",children:["Error loading recommendations: ",O.message]}),e[37]=O,e[38]=N):N=e[38];const xe=ie&&t.jsxs(Ne,{className:"bg-card text-card-foreground border-card",children:[t.jsxs(ve,{children:[t.jsx(Ce,{children:"Based on your history"}),t.jsxs(ke,{children:["Generated at ",new Date(ie.timestamp).toLocaleString()," (timeout: 5s)"]})]}),t.jsx(we,{children:t.jsx("ul",{className:"space-y-2",children:ie.data.recommendations.map((s,r)=>{const l=Ie(s.song),Te=btoa(s.song);return t.jsxs("li",{className:"flex flex-col space-y-2 p-2 border rounded",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(u,{to:"/dashboard/recommendations/id",params:{id:Te},className:"hover:underline",children:s.song}),t.jsxs("div",{className:"space-x-2",children:[t.jsx(d,{variant:"ghost",size:"sm",onClick:()=>Ae(s.song),children:"Queue"}),t.jsx(d,{variant:l.up?"default":"ghost",size:"sm",onClick:()=>D(s.song,"up"),children:"👍"}),t.jsx(d,{variant:l.down?"default":"ghost",size:"sm",onClick:()=>D(s.song,"down"),children:"👎"})]})]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.explanation.substring(0,100),"..."]})]},r)})})})]});let v;e[39]!==j||e[40]!==S||e[41]!==N||e[42]!==xe?(v=t.jsxs("section",{className:"space-y-4",children:[j,S,N,xe]}),e[39]=j,e[40]=S,e[41]=N,e[42]=xe,e[43]=v):v=e[43];const Qe="space-y-4";let V;e[44]===Symbol.for("react.memo_cache_sentinel")?(V=t.jsx("h2",{className:"text-2xl font-semibold",children:"Style-Based Playlist"}),e[44]=V):V=e[44];let C;e[45]!==fe?(C=t.jsxs("div",{className:"flex justify-between items-center",children:[V,t.jsx(d,{onClick:fe,variant:"outline",size:"sm",children:"Clear Cache"})]}),e[45]=fe,e[46]=C):C=e[46];let W;e[47]===Symbol.for("react.memo_cache_sentinel")?(W=s=>ye(s.target.value),e[47]=W):W=e[47];let k;e[48]!==h?(k=t.jsx(Be,{placeholder:"Enter style (e.g., Halloween, rock, holiday)",value:h,onChange:W,className:"flex-1"}),e[48]=h,e[49]=k):k=e[49];let w;e[50]!==c||e[51]!==ue||e[52]!==m||e[53]!==i?(w=()=>{localStorage.removeItem(`playlist-${m}`),c.invalidateQueries({queryKey:["playlist",m,i]}),ue()},e[50]=c,e[51]=ue,e[52]=m,e[53]=i,e[54]=w):w=e[54];const pe=!i;let _;e[55]!==w||e[56]!==pe?(_=t.jsx(d,{onClick:w,disabled:pe,children:"Generate"}),e[55]=w,e[56]=pe,e[57]=_):_=e[57];let I;e[58]!==k||e[59]!==_?(I=t.jsxs("div",{className:"flex gap-2",children:[k,_]}),e[58]=k,e[59]=_,e[60]=I):I=e[60];let E;e[61]!==me?(E=me&&t.jsx("p",{children:"Loading playlist..."}),e[61]=me,e[62]=E):E=e[62];let A;e[63]!==F?(A=F&&t.jsxs("p",{className:"text-destructive",children:["Error: ",F.message]}),e[63]=F,e[64]=A):A=e[64];const ge=y&&t.jsxs(Ne,{className:"bg-card text-card-foreground border-card",children:[t.jsxs(ve,{children:[t.jsxs(Ce,{children:['Generated Playlist for "',h,'"']}),t.jsx(ke,{children:"10 suggestions from your library. Add to queue or provide feedback."})]}),t.jsxs(we,{children:[t.jsx("div",{className:"flex justify-between mb-4",children:t.jsx(d,{onClick:Le,children:"Add Entire Playlist to Queue"})}),t.jsx("ul",{className:"space-y-2",children:y.data.playlist.map((s,r)=>{const l=Ie(s.song);return t.jsxs("li",{className:"flex flex-col space-y-2 p-2 border rounded",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-medium",children:s.song}),t.jsxs("div",{className:"space-x-2",children:[s.songId?t.jsx(d,{variant:"ghost",size:"sm",onClick:()=>P(s.songId,[{id:s.songId,name:s.song,albumId:"",duration:0,track:1,url:s.url}]),children:"Queue"}):t.jsx(d,{variant:"destructive",size:"sm",onClick:()=>he(s.song),children:"Add to Lidarr"}),t.jsx(d,{variant:l.up?"default":"ghost",size:"sm",onClick:()=>D(s.song,"up"),children:"👍"}),t.jsx(d,{variant:l.down?"default":"ghost",size:"sm",onClick:()=>D(s.song,"down"),children:"👎"})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:s.explanation}),s.missing&&t.jsx("p",{className:"text-xs text-destructive",children:"Not in library - consider adding via Lidarr"})]},r)})})]})]});let L;e[65]!==C||e[66]!==I||e[67]!==E||e[68]!==A||e[69]!==ge?(L=t.jsxs("section",{className:Qe,children:[C,I,E,A,ge]}),e[65]=C,e[66]=I,e[67]=E,e[68]=A,e[69]=ge,e[70]=L):L=e[70];let G;e[71]===Symbol.for("react.memo_cache_sentinel")?(G=t.jsxs(u,{to:"/",className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Home"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Return to the main page"})]}),e[71]=G):G=e[71];let M;e[72]===Symbol.for("react.memo_cache_sentinel")?(M=t.jsxs(u,{to:"/login",className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Login"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Sign in to your account"})]}),e[72]=M):M=e[72];let Y;e[73]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsxs(u,{to:"/signup",className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Signup"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Create a new account"})]}),e[73]=Y):Y=e[73];let U;e[74]===Symbol.for("react.memo_cache_sentinel")?(U=t.jsxs(u,{to:"/config",className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Service Configuration"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Configure your music service"})]}),e[74]=U):U=e[74];let X;e[75]===Symbol.for("react.memo_cache_sentinel")?(X=t.jsxs(u,{to:"/library/search",className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Search Library"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Find your favorite songs"})]}),e[75]=X):X=e[75];let Z;e[76]===Symbol.for("react.memo_cache_sentinel")?(Z=t.jsxs(u,{to:"/library/artists",className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Browse Artists"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Explore artists and albums"})]}),e[76]=Z):Z=e[76];let ee;e[77]===Symbol.for("react.memo_cache_sentinel")?(ee={id:"08jJDtStA34urKpsWC7xHt"},e[77]=ee):ee=e[77];let te;e[78]===Symbol.for("react.memo_cache_sentinel")?(te=t.jsxs(u,{to:"/library/artists/id",params:ee,className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Artist Detail"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"View artist information (Example)"})]}),e[78]=te):te=e[78];let se;e[79]===Symbol.for("react.memo_cache_sentinel")?(se={id:"08jJDtStA34urKpsWC7xHt",albumId:"1"},e[79]=se):se=e[79];let ae;e[80]===Symbol.for("react.memo_cache_sentinel")?(ae=t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[G,M,Y,U,X,Z,te,t.jsxs(u,{to:"/library/artists/id/albums/albumId",params:se,className:"card card-hover p-6 text-center block",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Album Detail"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"View album tracks (Example)"})]})]}),e[80]=ae):ae=e[80];let re;return e[81]!==b||e[82]!==v||e[83]!==L?(re=t.jsxs("div",{className:Pe,children:[b,v,L,ae]}),e[81]=b,e[82]=v,e[83]=L,e[84]=re):re=e[84],re}function We(e){return localStorage.removeItem(e)}function Ge(e){return e.startsWith("playlist-")}async function Me(e){try{const a=await fetch("/api/lidarr/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({song:e})}),o=await a.json();a.ok?alert(o.message):alert(`Error: ${o.error}`)}catch{alert("Failed to add to Lidarr. Please check configuration.")}}function Ye(e){return{id:e.songId,name:e.song,albumId:"",duration:0,track:1,url:e.url}}function Ue(e){return e.songId}function Xe(e){return e.addPlaylist}function Ze(e){return e.playSong}export{ct as component};
